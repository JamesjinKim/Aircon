# CHANGELOG

## v3.2 (2025-01-29) 🌡️

### ✨ **새로운 기능**

#### **온습도 센서 모니터링 시스템 추가**
- **SENSORS 탭 신규 추가**: 5번째 탭으로 배치 (SEMI AUTO와 AUTO 사이)
- **12개 센서 실시간 모니터링**: ID01~ID12 센서 데이터 표시
- **자동 갱신 기능**: 5초 주기로 자동 데이터 갱신
- **시각적 상태 표시**: 
  - 정상: 녹색 테두리 및 배경
  - 타임아웃: 빨간색 테두리 및 배경
  - 대기중: 회색 테두리 및 배경

#### **센서 데이터 표시 정보**
- **개별 센서당 표시 항목**:
  - 센서 ID (ID01~ID12)
  - 온도값 (°C)
  - 습도값 (%)
  - 연결 상태 (정상/타임아웃/대기중)
  - 마지막 업데이트 시간
- **요약 정보 표시**: 정상/타임아웃/대기중 센서 개수 실시간 집계

### 🔧 **시스템 구조 개선**

#### **새로운 모듈 추가**
- `managers/sensor_manager.py`: 센서 데이터 관리 및 파싱
- `ui/sensor_widget.py`: 개별 센서 표시 위젯
- `ui/sensor_tab.py`: SENSORS 탭 전체 레이아웃

#### **기존 모듈 확장**
- `managers/serial_manager.py`: 센서 데이터 콜백 메커니즘 추가
- `ui/main_window.py`: SENSORS 탭 통합 및 연결/해제 시 처리 로직

### 📡 **통신 프로토콜**

#### **센서 데이터 요청/응답**
- **요청 명령어**: `$CMD,DSCT,TH`
- **응답 형식**:
  - 정상: `[DSCT] ID01,TEMP: 28.3, HUMI: 67.7`
  - 타임아웃: `[DSCT] ID07,Sensor Check TIMEOUT!`
  - 완료: `[DSCT] SEQUENTIAL SCAN COMPLETE: Total: 12, Success: 6, Error: 6, Time: 7470ms`

### 🎯 **사용자 경험 개선**

#### **직관적인 인터페이스**
- **4×3 그리드 레이아웃**: 12개 센서를 한눈에 확인
- **실시간 상태 업데이트**: 색상과 텍스트로 즉각적인 피드백
- **수동 새로고침 버튼**: 필요시 즉시 데이터 갱신 가능

#### **안정성 강화**
- **연결 상태 연동**: 시리얼 연결/해제 시 자동으로 센서 모니터링 시작/중지
- **에러 처리**: 타임아웃 센서 명확히 표시
- **기존 기능 보존**: 다른 탭 기능에 영향 없이 독립적으로 동작

### 🛠️ **기술적 세부사항**

#### **데이터 구조**
```python
sensor_data = {
    'ID01': {
        'temp': 28.3,
        'humi': 67.7,
        'status': 'active',
        'last_update': datetime.now()
    },
    # ... ID02 ~ ID12
}
```

#### **시그널/슬롯 구조**
- `sensor_data_updated`: 개별 센서 업데이트 시그널
- `all_sensors_updated`: 전체 스캔 완료 시그널

### 📁 **파일 변경 사항**

#### **신규 파일**
- `managers/sensor_manager.py` (133 lines)
- `ui/sensor_widget.py` (125 lines)
- `ui/sensor_tab.py` (157 lines)

#### **수정된 파일**
- `ui/main_window.py`: import 문 추가, SENSORS 탭 통합
- `managers/serial_manager.py`: 콜백 메커니즘 추가

---

## v3.1 (2025-07-03) 🎯

### ✨ **새로운 기능**

#### **OA.DAMP 버튼 구조 개선**
- **3버튼 구조 도입**: OPEN + 숫자 + CLOSE 형태로 변경
- **균일한 버튼 크기**: OPEN과 CLOSE 버튼 모두 65×45px로 통일
- **새로운 함수**: `create_oa_damper_three_button_row()` 추가

#### **OA.DAMP 버튼 동작 로직 변경**
- **OPEN 버튼**: 
  - 클릭 시 숫자 +1 증가 (0~9 순환)
  - Green 색상으로 시각적 피드백
  - Serial 명령어: `$CMD,AIR,ALTDMP,OPEN,1` (고정값)
- **CLOSE 버튼**:
  - 클릭 시 숫자 -1 감소 (0에서 멈춤)
  - Green 색상으로 시각적 피드백
  - Serial 명령어: `$CMD,AIR,ALTDMP,CLOSE,1` (1 이상일 때만 전송)
- **숫자 버튼**: 이벤트 없음, 표시 전용

### 🔧 **개선 사항**

#### **UI/UX 개선**
- **그룹 명칭 변경**: "DAMPER CONTROLS" → "DAMP CONTROLS"
- **크기 일관성 보장**: `ensure_uniform_button_sizes()` 메서드에서 OA.DAMP 버튼 크기 재설정

#### **Serial 명령어 최적화**
- **SEMI AUTO TAB**: DAMP TEST 명령어 `DAMPTEST` → `DMPTEST`로 변경
- **조건부 전송**: CLOSE 버튼에서 숫자가 0일 때 명령어 전송 중단

### 🛠️ **기술적 개선**

#### **코드 구조**
- **새로운 이벤트 핸들러**: `create_new_oa_damper_controls()` 메서드 추가
- **기존 호환성 유지**: 기존 코드에 영향 없이 새 기능 구현
- **모듈화**: 기능별로 분리된 함수 구조

#### **상태 관리**
- **색상 피드백**: OPEN/CLOSE 버튼 간 상호 배타적 색상 변경
- **초기화 기능**: 연결 해제 시 버튼 상태 및 색상 초기화

### 📁 **수정된 파일**

#### **핵심 파일**
- `ui/ui_components.py`: 새로운 3버튼 함수 추가
- `managers/speed_manager.py`: 새로운 이벤트 핸들러 구현
- `ui/main_window.py`: 새 함수 연결 및 그룹 명칭 변경

#### **설정 파일**
- `ui/setup_buttons.py`: 토글 기능 제거 관련 수정
- `ref/aircon_dsct_cmd.txt`: 요구사항 문서 업데이트

### 🎯 **사용자 경험**

#### **직관적인 조작**
- **시각적 피드백**: 클릭한 버튼이 Green으로 변경되어 현재 선택 상태 표시
- **숫자 표시**: 클릭 횟수를 숫자로 시각적 확인 가능
- **안전한 조작**: 0에서 멈춤으로 예상치 못한 동작 방지

#### **하드웨어 제어 단순화**
- **고정값 전송**: 복잡한 숫자 값 대신 항상 1로 고정하여 하드웨어 제어 단순화
- **조건부 전송**: 불필요한 명령어 전송 방지

### 🔍 **버그 수정**

#### **버튼 크기 문제 해결**
- **원인**: `ensure_uniform_button_sizes()` 메서드가 OA.DAMP 버튼을 140px로 덮어쓰는 문제
- **해결**: OA.DAMP 버튼들을 65px로 재설정하는 코드 추가

#### **토글 기능 충돌 해결**
- **문제**: 기존 토글 기능과 새로운 이벤트 핸들러 충돌
- **해결**: 새로운 이벤트 핸들러가 기존 기능을 덮어쓰도록 구현

---

## v3.0 (2025년 7월 이전) 🎉
- **NEW**: SEMI AUTO 탭 추가
- **MAJOR**: 탭 구조 개편
- **IMPROVED**: 버튼 스타일 통일
- **ENHANCED**: 터치 친화적 UI 디자인
- **FIXED**: 시리얼 통신 안정성 개선